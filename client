import socket
import hashlib

def mod_exp(base, exponent, mod):
    result = 1
    base = base % mod
    while exponent > 0:
        if exponent % 2 == 1:
            result = (result * base) % mod
        exponent //= 2
        base = (base * base) % mod
    return result

# Same p and q must be entered
p = int(input("Enter prime p: "))
q = int(input("Enter prime q: "))

n = p * q
phi = (p - 1) * (q - 1)
e = 7

# Find d (not used but shown for completeness)
for i in range(1, phi):
    if (i * e) % phi == 1:
        d = i
        break

def encrypt_string(message):
    cipher_list = []
    for ch in message:
        ascii_val = ord(ch)
        cipher = mod_exp(ascii_val, e, n)
        cipher_list.append(cipher)
    return cipher_list

s = socket.socket()
s.connect(("localhost", 12345))

msg = input("Enter message: ")
cipher_text = encrypt_string(msg)

# Create hash
msg_hash = hashlib.sha256(msg.encode()).hexdigest()

data = ",".join(map(str, cipher_text)) + "|" + msg_hash

s.send(data.encode())
print("Encrypted message and hash sent")

s.close()
