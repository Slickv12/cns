import socket
import hashlib

def mod_exp(base, exponent, mod):
    result = 1
    base %= mod
    while exponent > 0:
        if exponent % 2 == 1:
            result = (result * base) % mod
        exponent //= 2
        base = (base * base) % mod
    return result

p = int(input("Enter prime p: "))
q = int(input("Enter prime q: "))

n = p * q
phi = (p - 1) * (q - 1)
e = 7

def encrypt_string(message):
    cipher_list = []
    for ch in message:
        cipher_list.append(mod_exp(ord(ch), e, n))
    return cipher_list

s = socket.socket()
s.connect(("localhost", 12345))

msg = input("Enter message: ")
cipher_text = encrypt_string(msg)

# MD5 hash generation
msg_hash = hashlib.md5(msg.encode()).hexdigest()

data = ",".join(map(str, cipher_text)) + "|" + msg_hash
s.send(data.encode())

print("Encrypted message and MD5 hash sent")

s.close()
